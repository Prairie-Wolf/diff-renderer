<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Diff-renderer by kof</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Diff-renderer</h1>
        <h2>Render diff to the dom.</h2>
        <a href="https://github.com/kof/diff-renderer" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h2>
<a name="what-is-diffrenderer" class="anchor" href="#what-is-diffrenderer"><span class="octicon octicon-link"></span></a>What is DiffRenderer</h2>

<p>DiffRenderer is a rendering component for your views, think of smart .innerHTML which renders the difference.</p>

<p>DiffRenderer is here to solve 1 issue - rendering of data changes to the DOM at 60fps.</p>

<p>DiffRenderer is designed in first place to play nicely with any library and web components.</p>

<p>DiffRenderer will dramatically simplify your view logic in non-trivial tasks.</p>

<p>Feel free to use any other project for events handling, templates, animations etc.</p>

<h2>
<a name="why" class="anchor" href="#why"><span class="octicon octicon-link"></span></a>Why</h2>

<p>DOM is slow. It has always been slow. There is no hope this will change in the near future.</p>

<p>We want to display the changes of our state or data without thinking about "how to render".
jQuery has fixed inconsistencies for popular DOM methods and made our live easier for years. In the meantime requirements on web applications grew up. Complex application logic and push notifications led us to the need of bidirectional bindings between UI and data.</p>

<p>Projects like <a href="https://github.com/facebook/react/">react</a> were born.</p>

<p>React is great. It solves lots of our problems, but the price is high. It comes at a price of "no compatibility" to all the things we have build in the last decade.</p>

<h2>
<a name="playground" class="anchor" href="#playground"><span class="octicon octicon-link"></span></a>Playground</h2>

<p>Visit <a href="//kof.github.com/diff-renderer/demo/playground.html">playground</a> to see it in action.</p>

<h2>
<a name="use-cases" class="anchor" href="#use-cases"><span class="octicon octicon-link"></span></a>Use cases</h2>

<ol>
<li>Replacement for jQuery's dom manipulation methods and any direct dom manipulation.</li>
<li>Easy RESTful http API implementation:
Client sends an object to the server, server validates it, client gets cleaned object back. With DiffRenderer we can apply the new one to the DOM without any checks.</li>
<li>Full bidirectional binding. For this you need to add the part for handling events and changing the state/data objects manually.</li>
<li>Real time data manipulation / rendering.</li>
</ol><h2>
<a name="how" class="anchor" href="#how"><span class="octicon octicon-link"></span></a>How</h2>

<ol>
<li>It accepts a snapshot of your state in html or json format. You can use any template engine or none.</li>
<li>It calculates the difference to the cached state of the dom.</li>
<li>Intelligently renders the difference by only modifying/adding/removing nodes it has to.</li>
<li>It reuses DOM elements.</li>
</ol><h2>
<a name="gotchas" class="anchor" href="#gotchas"><span class="octicon octicon-link"></span></a>Gotchas</h2>

<ol>
<li>Don't attach listeners to the elements within renderer container. Do event delegation.</li>
<li>Don't change elements directly, use DiffRenderer. If you (or some lib) changed an element directly - refresh DiffRenderer.</li>
</ol><h2>
<a name="bench" class="anchor" href="#bench"><span class="octicon octicon-link"></span></a>Bench</h2>

<ul>
<li>html parser - 200kb of html parsed in 15ms to json on my mb air.</li>
</ul><pre><code>    npm i
    make bench
</code></pre>

<ul>
<li>jsperf of html parser vs. dom parsers <a href="http://jsperf.com/domparser-vs-jsparser">http://jsperf.com/domparser-vs-jsparser</a>
</li>
<li>manual html parser memory test: open ./test/memory.html, observe your engines memory, click some times on buttons and see what happens</li>
</ul><h2>
<a name="api" class="anchor" href="#api"><span class="octicon octicon-link"></span></a>Api</h2>

<ul>
<li>Use <a href="https://github.com/kof/animation-frame">requestAnimationFrame shim</a> for older browsers.</li>
</ul><h3>
<a name="get-the-api" class="anchor" href="#get-the-api"><span class="octicon octicon-link"></span></a>Get the api</h3>

<ol>
<li>Commonjs <code>var DiffRenderer = require('diff-renderer')</code>
</li>
<li>From global

<ul>
<li>add script with browserified version from ./dist/diff-renderer.js</li>
<li>var DiffRenderer = window.DiffRenderer</li>
</ul>
</li>
</ol><h3>
<a name="diffrendererelement" class="anchor" href="#diffrendererelement"><span class="octicon octicon-link"></span></a>DiffRenderer(element)</h3>

<p>Create a renderer instance. Pass DOM element which you don't want to modify by DiffRenderer. Think of main view element f.e. like Backbone.View.prototype.el.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'my-view'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DiffRenderer</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
</pre></div>

<h3>
<a name="diffrendererupdatehtml" class="anchor" href="#diffrendererupdatehtml"><span class="octicon octicon-link"></span></a>DiffRenderer#update(html)</h3>

<p>Update renderer state with the new html.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">renderer</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">'&lt;div&gt;My new html&lt;/div&gt;'</span><span class="p">)</span>
</pre></div>

<h3>
<a name="diffrendererrefresh" class="anchor" href="#diffrendererrefresh"><span class="octicon octicon-link"></span></a>DiffRenderer#refresh()</h3>

<p>Serialize dom elements within renderer main element. You might need this if you modified the dom directly.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'my-view'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DiffRenderer</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">'&lt;div&gt;My new html&lt;/div&gt;'</span><span class="p">)</span>

<span class="c1">// Now me or some other library modifies the content (NOT RECOMMENDED)</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'&lt;span&gt;Test&lt;/span&gt;'</span>

<span class="c1">// Now you want renderer let know that content has changed.</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">refresh</span><span class="p">()</span>
</pre></div>

<h3>
<a name="diffrendererstart" class="anchor" href="#diffrendererstart"><span class="octicon octicon-link"></span></a>DiffRenderer.start()</h3>

<p>Start the renderer loop. Now on each animation frame renderer will render all queued changes.</p>

<div class="highlight highlight-javascript"><pre><span class="nx">DiffRenderer</span><span class="p">.</span><span class="nx">start</span><span class="p">()</span>

<span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'my-view'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Renderer</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>

<span class="nx">renderer</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s1">'My fresh content will be rendered in the next animation frame.'</span><span class="p">)</span>
</pre></div>

<h3>
<a name="diffrendererstop" class="anchor" href="#diffrendererstop"><span class="octicon octicon-link"></span></a>DiffRenderer.stop()</h3>

<p>Stop render loop.</p>

<h3>
<a name="diffrendererrender" class="anchor" href="#diffrendererrender"><span class="octicon octicon-link"></span></a>DiffRenderer.render()</h3>

<p>Render all queued changes from all renderer instances to the DOM. In the most cases you want to use <code>Renderer.start</code> instead.</p>

<div class="highlight highlight-javascript"><pre><span class="kd">var</span> <span class="nx">el1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'my-view-1'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">renderer1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Renderer</span><span class="p">(</span><span class="nx">el1</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">el2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'my-view-2'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">renderer2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Renderer</span><span class="p">(</span><span class="nx">el2</span><span class="p">)</span>

<span class="c1">// Now all virtual changes will be applied to the DOM.</span>
<span class="nx">DiffRenderer</span><span class="p">.</span><span class="nx">render</span><span class="p">()</span>
</pre></div>

<h2>
<a name="test" class="anchor" href="#test"><span class="octicon octicon-link"></span></a>Test</h2>

<ul>
<li><code>make build</code></li>
<li>Open the test suite ./test/index.html</li>
</ul>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/kof/diff-renderer/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/kof/diff-renderer/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/kof/diff-renderer"></a> is maintained by <a href="https://github.com/kof">kof</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-262517-4");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>